// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  // provider = "mysql"
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Persona {
  id              String    @id @default(uuid())
  nombre          String
  apellido        String
  telefono        String?
  direccion       String?
  fechaNacimiento DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relaciones
  usuario Usuario?
}

model Usuario {
  id              String     @id @default(uuid())
  personaId       String     @unique
  email           String     @unique
  passwordHash    String
  rol             RolUsuario
  emailVerificado Boolean    @default(false)
  activo          Boolean    @default(true)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  // Relaciones
  persona  Persona   @relation(fields: [personaId], references: [id], onDelete: Cascade)
  empleado Empleado?

  // Relaciones con ofertas
  ofertasAsignadas    OfertaLaboral[] @relation("OfertasAsignadas")
  ofertasPublicadas   OfertaLaboral[] @relation("OfertasPublicadas")
  ofertasAprobadas    OfertaLaboral[] @relation("OfertasAprobadas")
  ofertasActualizadas OfertaLaboral[] @relation("OfertasActualizadas")
}

model Empleado {
  id             String   @id @default(uuid())
  usuarioId      String   @unique
  departamentoId Int
  cargoId        Int
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relaciones
  usuario      Usuario      @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  departamento Departamento @relation(fields: [departamentoId], references: [id], onDelete: Restrict)
  cargo        Cargo        @relation(fields: [cargoId], references: [id], onDelete: Restrict)
}

model Departamento {
  id          Int      @id @default(autoincrement())
  descripcion String
  habilitado  Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relaciones
  empleados Empleado[]
}

model Cargo {
  id          Int      @id @default(autoincrement())
  descripcion String
  habilitado  Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relaciones
  empleados Empleado[]
}

model OfertaLaboral {
  id                    String      @id @default(uuid())
  puesto                String
  descripcionPuesto     String
  area                  String
  ubicacionPais         String
  ubicacionDepartamento String
  ubicacionCiudad       String
  empresa               String
  nivelAcademico        String
  experienciaLaboral    String
  tipoTrabajo           TipoTrabajo
  modalidad             Modalidad
  salario               Float

  reclutadorId     String?
  agregadoPorId    String
  actualizadoPorId String?
  aprobadoPorId    String?

  fechaCreacion      DateTime     @default(now())
  fechaActualizacion DateTime     @updatedAt
  estado             EstadoOferta @default(PENDIENTE)

  reclutador     Usuario?  @relation("OfertasAsignadas", fields: [reclutadorId], references: [id])
  agregadoPor    Usuario   @relation("OfertasPublicadas", fields: [agregadoPorId], references: [id])
  actualizadoPor Usuario?  @relation("OfertasActualizadas", fields: [actualizadoPorId], references: [id])
  aprobadoPor    Usuario?  @relation("OfertasAprobadas", fields: [aprobadoPorId], references: [id])

  habilidades OfertaHabilidad[]
}

model Habilidad {
  id        Int      @id @default(autoincrement())
  nombre    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ofertas OfertaHabilidad[]
}

model OfertaHabilidad {
  id              Int    @id @default(autoincrement())
  ofertaLaboralId String
  habilidadId     Int

  ofertaLaboral OfertaLaboral @relation(fields: [ofertaLaboralId], references: [id], onDelete: Cascade)
  habilidad     Habilidad     @relation(fields: [habilidadId], references: [id], onDelete: Cascade)

  @@unique([ofertaLaboralId, habilidadId])
}

enum RolUsuario {
  CANDIDATO
  RECLUTADOR
  ADMIN
}

enum TipoTrabajo {
  PERMANENTE
  TEMPORAL
}

enum Modalidad {
  PRESENCIAL
  REMOTO
  HIBRIDO
}

enum EstadoOferta {
  PENDIENTE
  ABIERTA
  RECHAZADA
  CERRADA
}
